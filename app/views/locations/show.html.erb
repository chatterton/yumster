<h2><%= @location.description %></h2>
<br>
<div class="row-fluid">
  <div class="span6 pull-right">
    <div class="map_container">
      <div id="map_canvas"></div>
    </div>
  </div>
  <div class="span6 pull-left no-left-margin">
    <p>
    This location is a <%= @location.category %>.<br>
    </p>

    <p>
    <%= pluralize(@location.tips.count, 'tip') %>:
    </p>

    <%# show the tips form if necessary %>
    <% if user_signed_in? and current_user.tips.where(:location_id => @location.id).count < 1 %>
      <%= form_for(@location.tips.build) do |f| %>
        <%= f.hidden_field :location_id, :value => "#{@location.id}" %>
        <%= f.label :text do %><small>Add a tip!</small><% end %>
        <%= f.text_area :text %>
        <br>
        <%= f.submit "Done", class: "btn" %>
      <% end %>
    <% end %>

    <%# show the list of tips %>
    <% if @location.tips.count > 0 %>
      <ul>
      <%= render @location.tips %>
      </ul>
    <% end %>
  </div>
</div>

<br><br>

<% content_for :scripts do %>
  <script src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false"></script>
  <%= javascript_include_tag 'geolocationmarker.js' %>
  <script type="text/javascript" charset="utf-8">

var position = new google.maps.LatLng(<%= @location.latitude %>, <%= @location.longitude %>)

var GeoMarker
var addPositionIndicator = function(map) {
  if(!GeoMarker) {
    GeoMarker = new GeolocationMarker()
    GeoMarker.setCircleOptions({fillColor: '#808080'})
    GeoMarker.setMap(map)
  }
}

var init = function() {
  map = new google.maps.Map(document.getElementById('map_canvas'), {
    zoom: 18,
    mapTypeId: google.maps.MapTypeId.HYBRID,
    tilt: 0, // turn of 45-degree imagery
    center: position
  })
  addPositionIndicator(map)
  marker = new google.maps.Marker({
    position: position,
    map: map
  })
}
google.maps.event.addDomListener(window, 'load', init)

  </script>
<% end %>
